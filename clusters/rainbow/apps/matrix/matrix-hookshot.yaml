apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: matrix-hookshot
  namespace: argocd
  # Add this finalizer ONLY if you want these to cascade delete.
  finalizers:
    - resources-finalizer.argocd.argoproj.io
spec:
  project: default

  destination:
    server: https://kubernetes.default.svc
    namespace: apps

  source:
    repoURL: https://matrix-org.github.io/matrix-hookshot
    targetRevision: 0.1.13 # For Helm, this refers to the chart version.

    chart: hookshot
    helm:
      valuesObject:
        hookshot:
          # -- Raw Hookshot configuration. Gets templated into a YAML file and then loaded unless an existingConfigMap is specified.
          config:
            bridge:
              # Basic homeserver configuration
              #
              domain: k8s.tuckerthomas.com
              url: http://matrix-dendrite.apps.svc.cluster.local:8008
              mediaUrl: https://example.com
              port: 9993
              bindAddress: 127.0.0.1
            generic:
              # (Optional) Support for generic webhook events.
              #'allowJsTransformationFunctions' will allow users to write short transformation snippets in code, and thus is unsafe in untrusted environments
              #
              #
              enabled: true
              enableHttpGet: false
              urlPrefix: https://example.com/webhook/
              #userIdPrefix: _webhooks_
              allowJsTransformationFunctions: false
              waitForComplete: false
            feeds:
              # (Optional) Configure this to enable RSS/Atom feed support
              #
              enabled: false
              pollIntervalSeconds: 600
              pollTimeoutSeconds: 30
            # provisioning:
              # (Optional) Provisioning API for integration managers
              #
              # secret: "!secretToken"
            passFile: passkey.pem
            # A passkey used to encrypt tokens stored inside the bridge.
            # Run openssl genpkey -out passkey.pem -outform PEM -algorithm RSA -pkeyopt rsa_keygen_bits:4096 to generate
            #
            # bot:
              # (Optional) Define profile information for the bot user
              #
              # displayname: Hookshot Bot
              # avatar: mxc://half-shot.uk/2876e89ccade4cb615e210c458e2a7a6883fe17d
            # serviceBots:
              # (Optional) Define additional bot users for specific services
              #
              # - localpart: feeds
              #   displayname: Feeds
              #   avatar: mxc://half-shot.uk/2876e89ccade4cb615e210c458e2a7a6883fe17d
              #   prefix: "!feeds"
              #   service: feeds
            metrics:
              # (Optional) Prometheus metrics support
              #
              enabled: true
            # queue:
              # (Optional) Message queue / cache configuration options for large scale deployments.
              # For encryption to work, must be set to monolithic mode and have a host & port specified.
              #
              # monolithic: true
              # port: 6379
              # host: localhost
            logging:
              # (Optional) Logging settings. You can have a severity debug,info,warn,error
              #
              level: debug
              colorize: true
              json: false
              timestampFormat: HH:mm:ss:SSS
            # widgets:
              # (Optional) EXPERIMENTAL support for complimentary widgets
              #
              # addToAdminRooms: false
              # disallowedIpRanges:
                # - 127.0.0.0/8
                # - 10.0.0.0/8
                # - 172.16.0.0/12
                # - 192.168.0.0/16
                # - 100.64.0.0/10
                # - 192.0.0.0/24
                # - 169.254.0.0/16
                # - 192.88.99.0/24
                # - 198.18.0.0/15
                # - 192.0.2.0/24
                # - 198.51.100.0/24
                # - 203.0.113.0/24
                # - 224.0.0.0/4
                # - ::1/128
                # - fe80::/10
                # - fc00::/7
                # - 2001:db8::/32
                # - ff00::/8
                # - fec0::/10
              # roomSetupWidget:
                # addOnInvite: false
              # publicUrl: https://example.com/widgetapi/v1/static/
              # branding:
                # widgetTitle: Hookshot Configuration
            # permissions:
              # (Optional) Permissions for using the bridge. See docs/setup.md#permissions for help
              #
              # - actor: example.com
              #   services:
              #     - service: "*"
              #       level: admin
            listeners:
              # (Optional) HTTP Listener configuration.
              # Bind resource endpoints to ports and addresses.
              # 'port' must be specified. Each listener must listen on a unique port.
              # 'bindAddress' will default to '127.0.0.1' if not specified, which may not be suited to Docker environments.
              # 'resources' may be any of webhooks, widgets, metrics, provisioning
              #
              - port: 9000
                bindAddress: 0.0.0.0
                resources:
                  - webhooks
              - port: 9001
                bindAddress: 127.0.0.1
                resources:
                  - metrics
                  - provisioning
              - port: 9002
                bindAddress: 0.0.0.0
                resources:
                  - widgets
          registration:
            id: matrix-hookshot
            as_token: ""
            hs_token: ""
            namespaces:
              rooms: []
              users: []
            sender_localpart: hookshot
            url: "http://example.com"
            rate_limited: false
          passkey: ""
